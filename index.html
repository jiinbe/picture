<!doctype html>
<html>
<head>
<title>Example Domain</title>

<meta charset="utf-8" />
<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="author" content="Ferry Ayunda" />
<meta name="description" content="Personal website." />
<link rel="stylesheet" href="app.css">

<script src="app/jquery.min.js"></script>
<script src="app/fabric.min.js"></script>
<script src="app/FileSaver.js"></script>
<script src="app/canvas-toBlob.js"></script>
</head>

<body>
<header>
<nav class=header-nav>
<h1 class=p-name rel="me">Example Domain</h1>
</nav>
</header>

<!--<p><img src="mask.png" alt="frame"></p>-->
<p><canvas class="cvs" id="c" width="700" height="700"></canvas></p>
<p><input type="file" id="imgLoader" accept="image/*"></p> 
<p><button id="download">Download</button></p>
				
<script>
canvas = new fabric.Canvas('c');
canvas.setOverlayImage('mask.png', canvas.renderAll.bind(canvas));

canvas.selection = false;

    
document.getElementById('imgLoader').onchange = function handleImage(e) {
var reader = new FileReader();
reader.onload = function (event) { console.log('fdsf');
var imgObj = new Image();
imgObj.src = event.target.result;
imgObj.onload = function () {
// start fabricJS stuff
            
var image = new fabric.Image(imgObj);
           
canvas.add(image);
            
          
}
        
}
reader.readAsDataURL(e.target.files[0]);
}
    
canvas.on('mouse:wheel', function(opt) {
var delta = opt.e.deltaY;
var zoom = canvas.getZoom();
zoom *= 0.999 ** delta;
if (zoom > 20) zoom = 20;
if (zoom < 0.01) zoom = 0.01;
canvas.setZoom(zoom);
opt.e.preventDefault();
opt.e.stopPropagation();
})
    
// canvas.on('mouse:wheel', function(opt) {
//   var delta = opt.e.deltaY;
//   var zoom = canvas.getZoom();
//   zoom *= 0.999 ** delta;
//   if (zoom > 20) zoom = 20;
//   if (zoom < 0.01) zoom = 0.01;
//   canvas.zoomToPoint({ x: opt.e.offsetX, y: opt.e.offsetY }, zoom);
//   opt.e.preventDefault();
//   opt.e.stopPropagation();
  
//   if (zoom < 400 / 1000) {
//   vpt[4] = 200 - 1000 * zoom / 2;
//   vpt[5] = 200 - 1000 * zoom / 2;
// } else {
//   if (vpt[4] >= 0) {
//     vpt[4] = 0;
//   } else if (vpt[4] < canvas.getWidth() - 1000 * zoom) {
//     vpt[4] = canvas.getWidth() - 1000 * zoom;
//   }
//   if (vpt[5] >= 0) {
//     vpt[5] = 0;
//   } else if (vpt[5] < canvas.getHeight() - 1000 * zoom) {
//     vpt[5] = canvas.getHeight() - 1000 * zoom;
//   }
// }
// })

// canvas.on('mouse:wheel', function(opt) {
// var delta = opt.e.deltaY;
// var zoom = canvas.getZoom();
// zoom *= 0.999 ** delta;
// if (zoom > 20) zoom = 20;
// if (zoom < 0.01) zoom = 0.01;
// canvas.zoomToPoint({ x: opt.e.offsetX, y: opt.e.offsetY }, zoom);
// opt.e.preventDefault();
// opt.e.stopPropagation();
// var vpt = this.viewportTransform;
// if (zoom < 400 / 1000) {
//   vpt[4] = 200 - 1000 * zoom / 2;
//   vpt[5] = 200 - 1000 * zoom / 2;
// } else {
//   if (vpt[4] >= 0) {
//     vpt[4] = 0;
//   } else if (vpt[4] < canvas.getWidth() - 1000 * zoom) {
//     vpt[4] = canvas.getWidth() - 1000 * zoom;
//   }
//   if (vpt[5] >= 0) {
//     vpt[5] = 0;
//   } else if (vpt[5] < canvas.getHeight() - 1000 * zoom) {
//     vpt[5] = canvas.getHeight() - 1000 * zoom;
//   }
// }
// });

$("#download").click(function(){
$("#c").get(0).toBlob(function(blob){
saveAs(blob, "myIMG.png");
});
});

</script>
</body>
</html>
